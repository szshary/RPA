<Task>
  <ExcelSession Folder="ExcelDocuments" FileName="070_Police_vadesi.xlsx">
    <!-- Get_Heir_Info -->
    <Phase Name="Get_Heir_Info" >
      <StoreExcelRangeToTable Worksheet="Sayfa1" Table="Heir_Exists_During_Jeopardy_List"/>
      <AddColumnToTable Table="Heir_Exists_During_Jeopardy_List" Column="LETTERS_SENT" MaxLength="5"/>
      <RemoveColumnFromTable Table="Heir_Exists_During_Jeopardy_List" Column="VARIS_SIRA_NO"/>
      <RemoveColumnFromTable Table="Heir_Exists_During_Jeopardy_List" Column="POLICE_SERTIFIKA_NO"/>
      <RemoveColumnFromTable Table="Heir_Exists_During_Jeopardy_List" Column="SBM_HAYMER_NO"/>
      <RemoveColumnFromTable Table="Heir_Exists_During_Jeopardy_List" Column="SIGORTA_SIRKET_KODU"/>
      <RemoveColumnFromTable Table="Heir_Exists_During_Jeopardy_List" Column="POLICE_SERTIFIKA_YENILEME_NO"/>
      <RemoveColumnFromTable Table="Heir_Exists_During_Jeopardy_List" Column="SIGORTALI_KIMLIK_TIPI"/>
      <RemoveColumnFromTable Table="Heir_Exists_During_Jeopardy_List" Column="POLICE_BASLAMA_TARIHI"/>
      <RemoveColumnFromTable Table="Heir_Exists_During_Jeopardy_List" Column="POLICE_BITIS_TARIHI"/>
      <RemoveColumnFromTable Table="Heir_Exists_During_Jeopardy_List" Column="VARIS_KIMLIK_TIPI"/>
      <RemoveColumnFromTable Table="Heir_Exists_During_Jeopardy_List" Column="YAKINLIK"/>
      <RemoveColumnFromTable Table="Heir_Exists_During_Jeopardy_List" Column="ADRES_IL_KODU"/>
      <RemoveColumnFromTable Table="Heir_Exists_During_Jeopardy_List" Column="UAVT_ADRES_NO"/>
      <RemoveColumnFromTable Table="Heir_Exists_During_Jeopardy_List" Column="TAZMINAT_NO"/>
      <RemoveColumnFromTable Table="Heir_Exists_During_Jeopardy_List" Column="TOPLAM_ODENEN_TAZMINAT"/>
      <RemoveColumnFromTable Table="Heir_Exists_During_Jeopardy_List" Column="TOPLAM_VEFAT_TEMINATI_TUTARI"/>
    </Phase>
  </ExcelSession>
  <DatabaseSession Host="10.10.10.106" User="PRO2456" Password="H4RB1NG3R">
  <!--<DatabaseSession Host="10.10.10.1" User="PRO2456" Password="H4RB1NG3R">-->
    <Phase Name="Get_Group_Types" >
      <StoreQueryResultToTable Table="Group_Types" SelectQuery="SELECT A.GRPKOD AS GROUP_CODE, (CASE WHEN A.TANKOD = 10 AND SUBSTR(A.RZV25, 5, 1) = 'İ' THEN 'KKDS' WHEN((A.TANKOD = 15 AND A.GRPFER = 'F' AND A.GRPKOK = ' ') OR (A.GRPKOD IN (162, 166, 240, 283, 284)) OR(A.RZV45 = 2 AND A.RZV48 &lt;&gt; 1)) THEN 'KDS' WHEN A.GRPKOD IN (6, 204, 837) THEN 'WILLSKIP' WHEN A.TANKOD = 10 THEN 'YILLIK_VEFAT' WHEN A.TANKOD = 24 THEN 'IRAT' ELSE 'STANDARD' END) AS GROUP_TYPE, (CASE WHEN A.DVZCDE = 0 THEN 'TL' ELSE 'DV' END) AS CURRENCY_TYPE FROM CGNLLIB.PFGRPTAN A WHERE A.KATKOD = 0 ORDER BY A.GRPKOD"/>
      <SetPrimaryKeyOfTable Table="Group_Types" UniqueConstraintColumns="GROUP_CODE"/>
    </Phase>
  </DatabaseSession>
  <TN5250Session Host="10.10.10.106" Port="23">
  <!--<TN5250Session Host="10.10.10.1" Port="23">-->
    <!-- Login -->
    <Phase Name="Login" >
      <WriteToTN5250 Value="PRO2456" Submit="false" MaxLength="10"/>
      <WriteToTN5250 Value="H4RB1NG3R" Submit="true"/>
    </Phase>
    <!-- IsQueueAlreadyAllocated -->
    <CompareValueWithTN5250 Value="PRO2456" Left="16" Top="4">
      <True>
        <WriteToTN5250 Value="" Submit="true"/>
      </True>
    </CompareValueWithTN5250>
    <!-- PRO2456_Redundant -->
    <Phase Name="PRO2456_Redundant">
      <WriteToTN5250 Value="CALL HYCLP001" Submit="true"/>
      <WriteToTN5250 Value="" Submit="true"/>
      <WriteToTN5250 Value="" Submit="true"/>
    </Phase>
    <!-- Get_Policies_by_TC_Number -->
    <Phase>
      <WriteToTN5250 Value="5" Submit="true"/>
      <WriteToTN5250 Value="13" Submit="true"/>
      <WriteToTN5250 Value="1" Submit="true"/>
      <!-- Start TC No Query screen with dummy TC Num -->
      <WriteToTN5250 Value="1" Submit="true"/>
    </Phase>
    <!-- Create_Mental_Table_Policies_Of_Customers -->
    <Phase>
    	<SetVariable Variable="SIGORTALI_KIMLIK_NO" Value="1000001"/>
    	<SetVariable Variable="GROUP_CODE" Value=""/>
    	<SetVariable Variable="POLICY_CODE" Value=""/>
    	<SetVariable Variable="SEVK_CODE" Value=""/>
    	<SetVariable Variable="VEFAT_TARIHI" Value=""/>
    	<CreateTable Table="Policies_Of_Customers"/>
    	<AddColumnToTable Table="Policies_Of_Customers" Column="GROUP_CODE" MaxLength="5"/>
    	<AddColumnToTable Table="Policies_Of_Customers" Column="POLICY_CODE" MaxLength="8"/>
      <AddColumnToTable Table="Policies_Of_Customers" Column="SIGORTALI_KIMLIK_NO" MaxLength="11"/>
      <AddColumnToTable Table="Policies_Of_Customers" Column="SEVK_CODE" MaxLength="5"/>
      <AddColumnToTable Table="Policies_Of_Customers" Column="FILE_OPENNED_FLAG" MaxLength="1"/>
      <SetPrimaryKeyOfTable Table="Policies_Of_Customers" UniqueConstraintColumns="GROUP_CODE,POLICY_CODE"/>
    </Phase>
    <Phase Name="Scrape_Policies_From_Console">
      <LoopThroughTable FileName="Scrape_Policies_From_Console_Loop.xml" Table="Heir_Exists_During_Jeopardy_List"/>
    </Phase>
    <!-- Switch_Menu -->
    <Phase>
      <!-- Customer_No_Not_Found -->
      <CompareValueWithTN5250 ComparedValue="GÖRÜNTÜLENEBİLECEK BİR BİLGİ BULUNMAMAKTADIR." Left="20" Top="12">
        <True>
          <WriteToTN5250 Value="" Submit="true"/>
        </True>
      </CompareValueWithTN5250>
      <SendFunctionKeyToTN5250 FunctionKey="F1"/>
      <SendFunctionKeyToTN5250 FunctionKey="F1"/>
      <SendFunctionKeyToTN5250 FunctionKey="F1"/>
      <WriteToTN5250 Value="3" Submit="true"/>
      <WriteToTN5250 Value="1" Submit="true"/>
      <WriteToTN5250 Value="2" Submit="true"/>
      <CompareValueWithTN5250 Value="Fon Yönetimi tarafından" Left="11" Top="8">
        <True>
          <LogEvent Format="Günlük fon fiyatları girilmediğinden dosya açımı işlemine başlanamamaktadır."/>
          <Terminate/>
        </True>
      </CompareValueWithTN5250>
    </Phase>
    <!-- Create_Compensation_Files -->
    <Phase>
      <DatabaseSession Host="10.10.10.106" User="PRO2456" Password="H4RB1NG3R">
      <!--<DatabaseSession Host="10.10.10.1" User="PRO2456" Password="H4RB1NG3R">-->
        <LoopThroughTable FileName="Product_Logic_Loop.xml" Table="Policies_Of_Customers"/>
      </DatabaseSession>
    </Phase>
  </TN5250Session>
  <DatabaseSession Host="10.10.10.106" User="PRO2456" Password="H4RB1NG3R">
  <!--<DatabaseSession Host="10.10.10.1" User="PRO2456" Password="H4RB1NG3R">-->
    <!-- Create_Cutomer_Letters -->
    <WordSession Folder="WordDocumentTemplates" TemplateFileName="SBM vefat.docx">
      <Phase>
        <SetVariable Variable="LETTER_COUNTER" Value="1"/>
        <SetVariable Variable="LETTERS_SENT" Value=""/>
        <SetVariable Variable="BENEFICIARY_FULLNAME" Value=""/>
        <SetVariable Variable="AD" Value=""/>
        <SetVariable Variable="SOYAD" Value=""/>
        <SetVariable Variable="ACIK_ADRES" Value=""/>
        <SetVariable Variable="DURUMU" Value=""/>
        <LoopThroughTable FileName="Create_Customer_Letters_Loop.xml" Table="Heir_Exists_During_Jeopardy_List"/>
      </Phase>
    </WordSession>
  </DatabaseSession>
  <!--<BrowserSession URL="https://ahecrmtest.anadoluhayat.com.tr/">-->
  <BrowserSession URL="https://ahecrm.anadoluhayat.com.tr/">
    <Phase Name="Login">
      <SendTextToBrowser Id="userNameInput" Value="ANADOLUHAYAT\PRO2456"/>
      <SendTextToBrowser Id="passwordInput" Value="H4rb1ng3r"/>
      <ClickBrowser Id="submitButton"/>
      <ClickBrowser Frame="InlineDialog_Iframe" Id="buttonClose"/>
    </Phase>
    <!-- Create_CRM_Cases -->
    <Phase>
      <LoopThroughTable FileName="Create_CRM_Cases_Loop.xml" Table="Policies_Of_Customers"/>
    </Phase>
  </BrowserSession>
</Task>